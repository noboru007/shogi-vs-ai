<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Shogi Web</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon.png">
    <meta name="theme-color" content="#8b4513">
    <link rel="apple-touch-icon" href="icon.png">
</head>

<body>
    <div class="container">
        <div class="game-area">
            <div id="gote-hand" class="hand-area">
                <div class="hand-label">[後手持駒] <span id="gote-thinking" class="thinking-label"
                        style="display:none;">(考え中...)</span></div>
                <div class="hand-pieces" id="gote-hand-pieces"></div>
            </div>

            <div id="board" class="board">
                <!-- Grid will be generated by JS -->
            </div>

            <div id="sente-hand" class="hand-area">
                <div class="hand-label">[先手持駒] <span id="sente-thinking" class="thinking-label"
                        style="display:none;">(考え中...)</span></div>
                <div class="hand-pieces" id="sente-hand-pieces"></div>
            </div>

            <div class="status-area">
                <div id="turn-indicator">手番: 先手 (下)</div>
                <div id="reasoning-area" style="display:none;"></div> <!-- AI Reason Box -->
                <div id="game-controls">
                    <button onclick="showAiSettings()">対局設定 (Game Settings)</button>
                </div>
            </div>

            <div id="ai-settings"
                style="display: none; padding: 10px; background: #fffbe6; border: 1px solid #ccc; margin-bottom: 10px;">
                <h3>対局設定</h3>
                <div>
                    <label>先手：</label>
                    <select id="sente-model">
                        <option value="gemini-3-pro-preview">Gemini 3 Pro Preview</option>
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                        <option value="gemini-3-flash-preview">Gemini 3 Flash Preview</option>
                        <option value="gpt-5.2-pro">GPT-5.2 Pro</option>
                        <option value="gpt-5.1-codex-max">GPT-5.1 Codex Max</option>
                        <option value="gpt-5.1-codex">GPT-5.1 Codex</option>
                        <option value="gpt-5.1">GPT-5.1</option>
                        <option value="gpt-5-pro">GPT-5 Pro</option>
                        <option value="gpt-5">GPT-5</option>
                        <option value="gpt-5-mini">GPT-5 Mini</option>
                        <option value="human" selected>人間</option>
                        <option value="cpu">8手先まで読むCPU</option>
                    </select>
                </div>
                <div>
                    <label>RETRY回数：</label>
                    <select id="max-retries">
                        <option value="1">1回</option>
                        <option value="2" selected>2回</option>
                        <option value="3">3回</option>
                    </select>
                    <span class="info-icon" onclick="showRetryInfo()">ℹ️</span>
                </div>
                <div>
                    <label>後手：</label>
                    <select id="gote-model">
                        <option value="gemini-3-pro-preview">Gemini 3 Pro Preview</option>
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                        <option value="gemini-3-flash-preview">Gemini 3 Flash Preview</option>
                        <option value="gpt-5.2-pro">GPT-5.2 Pro</option>
                        <option value="gpt-5.1-codex-max">GPT-5.1 Codex Max</option>
                        <option value="gpt-5.1-codex">GPT-5.1 Codex</option>
                        <option value="gpt-5.1">GPT-5.1</option>
                        <option value="gpt-5-pro">GPT-5 Pro</option>
                        <option value="gpt-5">GPT-5</option>
                        <option value="gpt-5-mini">GPT-5 Mini</option>
                        <option value="human">人間</option>
                        <option value="cpu">8手先まで読むCPU</option>
                    </select>
                </div>

                <hr style="margin: 15px 0;">

                <!-- Resume Feature -->
                <div style="margin-bottom: 10px;">
                    <details>
                        <summary style="cursor: pointer; color: #555;">上級者: SFENから再開</summary>
                        <div style="margin-top: 5px;">
                            <input type="text" id="resume-sfen" placeholder="SFEN文字列を入力..."
                                style="width: 100%; padding: 5px; margin-bottom: 5px;">
                            <button onclick="startAiVsAiMatch(true)"
                                style="background: #e0e0e0; color: #333;">SFENから再開</button>
                        </div>
                    </details>
                </div>

                <button onclick="startAiVsAiMatch(false)">対局開始</button>
            </div>

            <div class="sfen-area">
                <div class="sfen-controls">
                    <span class="sfen-label">盤上の駒データ（SFEN）をコピーしてAIに相談。</span>
                    <button id="copy-btn" onclick="copySfen()">📋 コピー</button>
                </div>
                <textarea id="sfen-entry" rows="3" readonly></textarea>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="retry-info-modal" class="modal-overlay" onclick="closeRetryInfo(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeRetryInfo()">×</span>
            <p>使用しているLLMは将棋に特化したものではありません。そのためSFENデータを正確に読むことができずに、誤った手を打とうとすることがあります。</p>
            <p>アプリはこのRetry回数だけLLMに次の手を考えさせ、それでも正しい手を打つことができなかった場合、自身が代わりに差してターンを終了します。</p>
        </div>
    </div>

    <!-- Promotion Modal -->
    <div id="promotion-modal" class="modal-overlay">
        <div class="modal-content" style="text-align: center;">
            <p style="font-size: 1.2em; font-weight: bold; margin-bottom: 20px;">成りますか？</p>
            <div style="display: flex; justify-content: center; gap: 20px;">
                <button onclick="resolvePromotion(true)"
                    style="padding: 10px 20px; font-size: 1.1em; cursor: pointer;">成る</button>
                <button onclick="resolvePromotion(false)"
                    style="padding: 10px 20px; font-size: 1.1em; cursor: pointer;">成らない</button>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="modal-overlay"
        onclick="document.getElementById('game-over-modal').style.display = 'none'">
        <div class="modal-content" style="text-align: center;" onclick="event.stopPropagation()">
            <p style="font-size: 1.5em; font-weight: bold; margin-bottom: 20px;">勝負あり！</p>
            <p id="game-over-message" style="margin-bottom: 20px;">新しい対局を選んでください</p>
            <button onclick="document.getElementById('game-over-modal').style.display = 'none'"
                style="padding: 10px 20px; font-size: 1.1em; cursor: pointer;">閉じる</button>
        </div>
    </div>

    <!-- Generic Message Modal -->
    <div id="message-modal" class="modal-overlay" onclick="closeMessage(event)">
        <div class="modal-content" style="text-align: center;" onclick="event.stopPropagation()">
            <span class="modal-close-btn" onclick="closeMessage()">×</span>
            <p id="message-text" style="margin-bottom: 20px; font-size: 1.1em;"></p>
            <button onclick="closeMessage()" style="padding: 10px 20px; font-size: 1.1em; cursor: pointer;">閉じる</button>
        </div>
    </div>

    <script src="script.js?v=debug3"></script>
</body>

</html>